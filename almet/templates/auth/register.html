{% extends 'base.html' %}

{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <h2 class="text-center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form id="registerForm" class="mt-4">
            {% csrf_token %}
            <div class="mb-3">
                <label for="familia" class="form-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" class="form-control" id="familia" name="familia" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é">
            </div>
            <div class="mb-3">
                <label for="name" class="form-label">–ò–º—è</label>
                <input type="text" class="form-control" id="name" name="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            <div class="mb-3">
                <label for="otchestvo" class="form-label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input type="text" class="form-control" id="otchestvo" name="otchestvo" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É">
            </div>
            <div class="mb-3">
                <label for="tel" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="text" class="form-control" id="tel" name="tel" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω">
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <div class="input-group">
                    <input type="password" class="form-control" id="password" name="password" required placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                    <button type="button" class="btn btn-outline-secondary" id="togglePassword" onclick="togglePasswordVisibility('password', 'togglePassword')">üëÅÔ∏è‚Äçüó®Ô∏è</button>
                </div>
            </div>
            <div class="mb-3">
                <label for="password2" class="form-label">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                <div class="input-group">
                    <input type="password" class="form-control" id="password2" name="password2" required placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    <button type="button" class="btn btn-outline-secondary" id="togglePassword2" onclick="togglePasswordVisibility('password2', 'togglePassword2')">üëÅÔ∏è‚Äçüó®Ô∏è</button>
                </div>
            </div>
            <div class="mb-3">
                <input type="checkbox" id="soglasen" name="soglasen" required>
                <label for="soglasen" class="form-label">–°–æ–≥–ª–∞—Å–µ–Ω —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
            </div>
            <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <div id="message" class="mt-3"></div> <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π -->
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
    function togglePasswordVisibility(inputId, buttonId) {
        const input = document.getElementById(inputId);
        const button = document.getElementById(buttonId);
        if (input.type === "password") {
            input.type = "text";
            button.innerHTML = "üëÅÔ∏è";
        } else {
            input.type = "password";
            button.innerHTML = "üëÅÔ∏è‚Äçüó®Ô∏è";
        }
    }

    $(document).ready(function(){
        $('#tel').mask('+7 (000) 000-00-00');

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        $('#registerForm').on('submit', function(e) {
            e.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã

            // –ü–æ–ª—É—á–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω
            const csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

            $.ajax({
                url: '{% url "register" %}',  // URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                type: 'POST',
                headers: {
                    "X-CSRFToken": csrfToken  // –ü–µ—Ä–µ–¥–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
                },
                data: $(this).serialize(),  // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                success: function(response) {
                    if (response.success) {
                        $('#message').html('<div class="alert alert-success">' + response.message + '</div>');
                        if (response.redirect) {
                            window.location.href = response.redirect;  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è
                        }
                    } else {
                        $('#message').html('<div class="alert alert-danger">' + response.message + '</div>');
                    }
                },
                error: function() {
                    $('#message').html('<div class="alert alert-danger">–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö.</div>');
                }
            });
        });
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", function() {
        function validateCyrillic(input) {
            input.value = input.value.replace(/[^–ê-–Ø–∞-—è–Å—ë\s-]/g, '');
        }

        document.getElementById("familia").addEventListener("input", function() { validateCyrillic(this); });
        document.getElementById("name").addEventListener("input", function() { validateCyrillic(this); });
        document.getElementById("otchestvo").addEventListener("input", function() { validateCyrillic(this); });
    });
</script>
{% endblock %}
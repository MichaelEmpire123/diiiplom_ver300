{% extends 'base.html' %}

{% block title %}–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card mt-4">
            <div class="card-body">

                <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/profile/' %}active{% endif %}" href="{% url 'profile' %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
                        </li>
                    <!-- –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
                    {% if user.is_staff or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/admin/' %}active{% endif %}" href="/admin">–ê–¥–º–∏–Ω–∫–∞ Django</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/admin_categories/' %}active{% endif %}" href="{% url 'admin_categories' %}">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/admin_users/' %}active{% endif %}" href="{% url 'admin_users' %}">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/admin_create_service/' %}active{% endif %}" href="{% url 'admin_create_service' %}">–°–æ–∑–¥–∞—Ç—å –≥–æ—Ä–æ–¥—Å–∫—É—é —Å–ª—É–∂–±—É</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/admin_create_employee/' %}active{% endif %}" href="{% url 'admin_create_employee' %}">–°–æ–∑–¥–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å–ª—É–∂–±—ã</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/admin_all_appeals/' %}active{% endif %}" href="{% url 'admin_all_appeals' %}">–í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/administrator/statistics/' %}active{% endif %}" href="{% url 'admin_statistics' %}">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                        </li>
                    {% endif %}

                    <!-- –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∂–∏—Ç–µ–ª—è -->
                    {% if user.id_citizen %}
                        <li class="nav_item">
                            <a class="nav-link a_1 {% if request.path == '/update_profile/' %}active{% endif %}" href="{% url 'update_profile' %}">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/create_appeal/' %}active{% endif %}" href="{% url 'create_appeal' %}">–ü–æ–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/view_appeals/' %}active{% endif %}" href="{% url 'view_appeals' %}">–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</a>
                        </li>
                    {% endif %}

                    <!-- –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
                    {% if user.id_sotrudnik %}
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/employee_appeals/' %}active{% endif %}" href="{% url 'employee_appeals' %}">–û–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–ª—É–∂–±–µ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/create_report/' %}active{% endif %}" href="{% url 'create_report' %}">–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link a_1 {% if request.path == '/employee/statistics/' %}active{% endif %}" href="{% url 'service_statistics' %}">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>


    <div class="col-md-6">
        <h2 class="text-center mb-4">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h2>
        <form method="post" action="{% url 'update_profile' %}" class="mt-4">
            {% csrf_token %}
            <div class="mb-3">
                <label for="surname" class="form-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" class="form-control" id="surname" name="surname" value="{{ user.id_citizen.surname }}">
            </div>
            <div class="mb-3">
                <label for="name" class="form-label">–ò–º—è</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ user.id_citizen.name }}">
            </div>
            <div class="mb-3">
                <label for="patronymic" class="form-label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input type="text" class="form-control" id="patronymic" name="patronymic" value="{{ user.id_citizen.patronymic }}">
            </div>
            <div class="mb-3">
                <label for="tel" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="text" class="form-control" id="tel" name="tel" value="{{ user.id_citizen.tel }}">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ user.id_citizen.email }}">
            </div>
            <div class="mb-3">
                <label for="city" class="form-label">–ì–æ—Ä–æ–¥</label>
                <input type="text" class="form-control" id="city" name="city" value="{{ user.id_citizen.id_city.name_city|default:'' }}">
            </div>
            <div class="mb-3">
                <label for="street" class="form-label">–£–ª–∏—Ü–∞</label>
                <input type="text" class="form-control" id="street" name="street" value="{{ user.id_citizen.id_street.name_street|default:'' }}">
            </div>
            <div class="mb-3">
                <label for="house" class="form-label">–î–æ–º</label>
                <input type="text" class="form-control" id="house" name="house" value="{{ user.id_citizen.house|default:'' }}">
            </div>
            <div class="mb-3">
                <label for="flat" class="form-label">–ö–≤–∞—Ä—Ç–∏—Ä–∞</label>
                <input type="text" class="form-control" id="flat" name="flat" value="{{ user.id_citizen.flat|default:'' }}">
            </div>

            <button type="submit" class="btn btn-primary w-100">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>

        <p class="text-center mt-3">–•–æ—Ç–∏—Ç–µ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å? <a href="{% url 'change_password' %}">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a></p>
    </div>
</div>

<style>
    .nav-link.active {
        font-weight: bold;
        color: #007bff !important;
        background-color: #f8f9fa;
        border-radius: 5px;
    }

    .a_1 {
        color: #333;
        padding: 8px 12px;
        margin: 4px 0;
        text-decoration: none;
    }

    .a_1:hover {
        background-color: #f8f9fa;
        border-radius: 5px;
    }

    .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .card-title {
        font-size: 1.25rem;
        margin-bottom: 1rem;
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
    document.querySelectorAll(".toggle-password").forEach(button => {
        button.addEventListener("click", function() {
            const targetId = this.getAttribute("data-target");
            const input = document.getElementById(targetId);
            if (input.type === "password") {
                input.type = "text";
                this.innerHTML = "üôà";
            } else {
                input.type = "password";
                this.innerHTML = "üëÅ";
            }
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        function validateCyrillic(input) {
            input.value = input.value.replace(/[^–ê-–Ø–∞-—è–Å—ë\s-]/g, '');
        }

        document.getElementById("surname").addEventListener("input", function() { validateCyrillic(this); });
        document.getElementById("name").addEventListener("input", function() { validateCyrillic(this); });
        document.getElementById("patronymic").addEventListener("input", function() { validateCyrillic(this); });
    });

    $(document).ready(function(){
        $('#tel').mask('+7 (000) 000-00-00');
    });
</script>

<style>
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã */
    .form-control {
        border-radius: 8px;
        border: 1px solid #ddd;
        padding: 10px;
        font-size: 1rem;
    }

    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }

    .form-label {
        font-weight: 500;
        margin-bottom: 5px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
    .btn-primary {
        background-color: #007bff;
        border: none;
        border-radius: 8px;
        padding: 10px;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–∫–∏ "–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å" */
    a {
        color: #007bff;
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }

    /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
    .text-center {
        text-align: center;
    }

    /* –û—Ç—Å—Ç—É–ø—ã */
    .mt-4 {
        margin-top: 1.5rem;
    }

    .mb-3 {
        margin-bottom: 1rem;
    }

    .mt-3 {
        margin-top: 1rem;
    }
</style>
{% endblock %}